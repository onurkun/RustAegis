name: Rust
on:
    push:
      branches: [ "main" ]
    pull_request:
      branches: [ "main" ]

env:
    CARGO_TERM_COLOR: always

jobs:
    build:
      runs-on: ubuntu-latest
      steps:
      - uses: actions/checkout@v4
      - name: Build
        run: cargo build --verbose
      - name: Run tests
        run: cargo test --verbose

    # Async VM feature tests (experimental)
    async_vm:
      runs-on: ubuntu-latest
      steps:
      - uses: actions/checkout@v4
      - name: Build with async_vm
        run: cargo build --features async_vm --verbose
      - name: Test async_vm
        run: cargo test --features async_vm --verbose

    # no_std / WASM uyumluluÄŸu
    wasm:
      runs-on: ubuntu-latest
      steps:
      - uses: actions/checkout@v4
      - name: Install wasm target
        run: rustup target add wasm32-unknown-unknown
      - name: Build WASM
        run: cargo build --target wasm32-unknown-unknown --no-default-features --features whitebox_lite

    # code quality
    clippy:
      runs-on: ubuntu-latest
      steps:
      - uses: actions/checkout@v4
      - name: Clippy
        run: cargo clippy -- -D warnings
